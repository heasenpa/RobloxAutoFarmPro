-- MM2 Ultra Smooth Auto Farm
-- Liên tục, cực nhanh, no-clip, ưu tiên BeachBall

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- Cài đặt
local scanRange = 200
local speed = 300 -- units per second

-- HUD
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local counterLabel = Instance.new("TextLabel", screenGui)
counterLabel.Size = UDim2.new(0,200,0,50)
counterLabel.Position = UDim2.new(0,10,0,10)
counterLabel.BackgroundTransparency = 0.5
counterLabel.BackgroundColor3 = Color3.new(0,0,0)
counterLabel.TextColor3 = Color3.new(1,1,1)
counterLabel.TextScaled = true
counterLabel.Text = "Balls: 0 | Coins: 0"

local ballCount, coinCount = 0,0
local items = {}

local function updateHUD()
    counterLabel.Text = ("Balls: %d | Coins: %d"):format(ballCount, coinCount)
end

-- No-clip
RunService.Stepped:Connect(function()
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end)

-- Thêm vật phẩm
local function addItem(obj)
    if obj:IsA("BasePart") then
        local name = obj.Name:lower()
        if name:find("beachball") or name:find("coin") then
            items[obj] = name
            obj.AncestryChanged:Connect(function(_, parent)
                if not parent and items[obj] then
                    if items[obj]:find("beachball") then
                        ballCount += 1
                    else
                        coinCount += 1
                    end
                    items[obj] = nil
                    updateHUD()
                end
            end)
        end
    end
end

Workspace.DescendantAdded:Connect(addItem)
for _, obj in ipairs(Workspace:GetDescendants()) do
    addItem(obj)
end

-- Thêm BodyVelocity để di chuyển mượt
local bv = Instance.new("BodyVelocity")
bv.MaxForce = Vector3.new(1e5,1e5,1e5)
bv.Velocity = Vector3.new(0,0,0)
bv.Parent = hrp

-- Vòng lặp farm
RunService.RenderStepped:Connect(function(dt)
    local closest, closestDist, closestName
    local hrpPos = hrp.Position
    for obj, name in pairs(items) do
        if obj.Parent then
            local dist = (hrpPos - obj.Position).Magnitude
            if dist <= scanRange then
                if not closest or dist < closestDist or (closestName:find("coin") and name:find("beachball")) then
                    closest = obj
                    closestDist = dist
                    closestName = name
                end
            end
        end
    end

    if closest then
        local dir = (closest.Position - hrp.Position).Unit
        bv.Velocity = dir * speed
    else
        bv.Velocity = Vector3.new(0,0,0)
    end
end)
