-- MM2 Pro Coin Farm (Path Optimized, NoClip, Accurate Pickup)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Config
local SCAN_RANGE = 150 -- khoảng quét
local SCAN_DELAY = 0.015
local MOVE_SPEED = 100 -- tốc độ bay
local PICKUP_RADIUS = 3

-- HUD
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local counterLabel = Instance.new("TextLabel", screenGui)
counterLabel.Size = UDim2.new(0, 220, 0, 40)
counterLabel.Position = UDim2.new(0, 10, 0, 10)
counterLabel.BackgroundTransparency = 0.4
counterLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
counterLabel.TextColor3 = Color3.new(1, 1, 0)
counterLabel.Font = Enum.Font.GothamBold
counterLabel.TextScaled = true
counterLabel.Text = "Coins: 0"

local coinCount = 0
local coins = {}

-- NoClip
RunService.Stepped:Connect(function()
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end)

-- Thêm coin khi spawn
local function trackCoin(obj)
    if obj:IsA("BasePart") and obj.Name:lower():find("coin") then
        table.insert(coins, obj)
        obj.AncestryChanged:Connect(function(_, parent)
            if not parent then
                coinCount += 1
                counterLabel.Text = ("Coins: %d"):format(coinCount)
            end
        end)
    end
end

Workspace.DescendantAdded:Connect(trackCoin)
for _, obj in ipairs(Workspace:GetDescendants()) do
    trackCoin(obj)
end

-- Lấy coin gần nhất
local function getClosestCoin()
    local closest, closestDist
    for i, coin in ipairs(coins) do
        if coin and coin.Parent then
            local dist = (hrp.Position - coin.Position).Magnitude
            if dist <= SCAN_RANGE then
                if not closest or dist < closestDist then
                    closest = coin
                    closestDist = dist
                end
            else
                coins[i] = nil
            end
        else
            coins[i] = nil
        end
    end
    return closest
end

-- Pickup
local function pickupCoin(coin)
    firetouchinterest(hrp, coin, 0)
    firetouchinterest(hrp, coin, 1)
end

-- Loop
task.spawn(function()
    while task.wait(SCAN_DELAY) do
        local coin = getClosestCoin()
        if coin then
            local dist = (hrp.Position - coin.Position).Magnitude
            if dist > PICKUP_RADIUS then
                local targetPos = coin.Position + Vector3.new(0, 1, 0)
                local dir = (targetPos - hrp.Position).Unit
                hrp.CFrame = CFrame.new(hrp.Position + dir * MOVE_SPEED * SCAN_DELAY, targetPos)
            else
                pickupCoin(coin)
            end
        end
    end
end)
