-- MM2 Safe Auto Pickup Coins Only (Optimized HUD)
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Cài đặt
local scanRange = 100       -- tầm quét coin
local speed = 25            -- tốc độ bay
local pickupHeight = 2      -- bay cao hơn coin
local scanDelay = 0.05      -- quét nhanh
local pickupDistance = 3    -- khoảng cách bắt đầu nhặt

-- HUD
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local counterLabel = Instance.new("TextLabel", screenGui)
counterLabel.Size = UDim2.new(0, 200, 0, 50)
counterLabel.Position = UDim2.new(0, 10, 0, 10)
counterLabel.BackgroundTransparency = 0.5
counterLabel.BackgroundColor3 = Color3.new(0,0,0)
counterLabel.TextColor3 = Color3.new(1,1,1)
counterLabel.TextScaled = true
counterLabel.Text = "Coins: 0"

local coinCount = 0
local items = {}

local function updateHUD()
    counterLabel.Text = ("Coins: %d"):format(coinCount)
end

-- Thêm coin mới spawn
local function addItem(obj)
    if obj:IsA("BasePart") then
        local name = obj.Name:lower()
        if name:find("coin") then
            table.insert(items, obj)

            -- Khi chạm coin thì mới cộng
            obj.Touched:Connect(function(hit)
                if hit and hit.Parent == character then
                    coinCount += 1
                    updateHUD()
                    -- Xóa khỏi danh sách
                    for i, v in ipairs(items) do
                        if v == obj then
                            table.remove(items, i)
                            break
                        end
                    end
                end
            end)
        end
    end
end

-- Quét ban đầu
for _, obj in ipairs(Workspace:GetDescendants()) do
    addItem(obj)
end
Workspace.DescendantAdded:Connect(addItem)

-- Lấy coin gần nhất
local function getClosestItem()
    local closest, closestDist
    for _, obj in ipairs(items) do
        if obj and obj.Parent then
            local dist = (hrp.Position - obj.Position).Magnitude
            if dist <= scanRange then
                if not closest or dist < closestDist then
                    closest, closestDist = obj, dist
                end
            end
        end
    end
    return closest
end

-- Di chuyển mượt + nhặt coin
task.spawn(function()
    while task.wait(scanDelay) do
        local target = getClosestItem()
        if target and target.Parent then
            local targetPos = target.Position + Vector3.new(0, pickupHeight, 0)
            local direction = (targetPos - hrp.Position).Unit
            hrp.CFrame = CFrame.new(hrp.Position + direction * speed * scanDelay, targetPos)

            -- Khi gần coin thì chạm
            if (hrp.Position - target.Position).Magnitude <= pickupDistance then
                firetouchinterest(hrp, target, 0)
                firetouchinterest(hrp, target, 1)
            end
        end
    end
end)
