-- AutoFarm Hybrid - bản không GUI (toggle qua gõ lại script)
-- Codex Mobile Compatible

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local hrp, humanoid

local running = false

local function updateChar()
    local c = player.Character
    if not c then return end
    humanoid = c:FindFirstChildOfClass("Humanoid")
    hrp = c:FindFirstChild("HumanoidRootPart")
end
updateChar()
player.CharacterAdded:Connect(function()
    task.wait(1)
    updateChar()
end)

-- tìm coin
local function getCoins()
    local coins = {}
    for _,v in pairs(workspace:GetDescendants()) do
        if v:IsA("TouchTransmitter") and v.Parent and v.Parent:IsA("BasePart") then
            table.insert(coins, v.Parent)
        elseif v:IsA("BasePart") then
            local n = v.Name:lower()
            if n:find("coin") or n:find("ball") or n:find("token") then
                table.insert(coins, v)
            end
        end
    end
    return coins
end

-- di chuyển hybrid
local function moveToCoin(coin)
    if not humanoid or not hrp or not coin then return end
    local distance = (hrp.Position - coin.Position).Magnitude
    if distance < 6 then return end

    if math.abs(hrp.Position.Y - coin.Position.Y) > 6 then
        local tween = TweenService:Create(hrp, TweenInfo.new(distance/40, Enum.EasingStyle.Linear), {CFrame = CFrame.new(coin.Position + Vector3.new(0,3,0))})
        tween:Play()
        tween.Completed:Wait()
    else
        humanoid:MoveTo(coin.Position)
        humanoid.MoveToFinished:Wait(2)
    end
end

-- vòng lặp farm
local function farmLoop()
    warn("[AutoFarm] Đã bật")
    while running do
        updateChar()
        if hrp then
            local coins = getCoins()
            local nearest, nd = nil, math.huge
            for _,c in pairs(coins) do
                local ok,pos = pcall(function() return c.Position end)
                if ok and pos then
                    local d = (hrp.Position - pos).Magnitude
                    if d < nd then
                        nd = d; nearest = c
                    end
                end
            end
            if nearest then
                moveToCoin(nearest)
            end
        end
        task.wait(0.4)
    end
    warn("[AutoFarm] Đã tắt")
end

-- Toggle
if running == false then
    running = true
    task.spawn(farmLoop)
else
    running = false
end
