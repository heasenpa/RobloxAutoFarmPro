-- MM2 Instant Teleport Pickup
-- Ưu tiên BeachBall trước Coin, dịch chuyển tức thì

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Cấu hình
local scanRange = 100 -- Khoảng cách tìm vật phẩm
local pickupHeight = 2 -- Bay cao hơn một chút khi dịch chuyển
local scanDelay = 0.05 -- Quét nhanh (giảm delay)

-- HUD
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local counterLabel = Instance.new("TextLabel", screenGui)
counterLabel.Size = UDim2.new(0, 200, 0, 50)
counterLabel.Position = UDim2.new(0, 10, 0, 10)
counterLabel.BackgroundTransparency = 0.5
counterLabel.BackgroundColor3 = Color3.new(0,0,0)
counterLabel.TextColor3 = Color3.new(1,1,1)
counterLabel.TextScaled = true
counterLabel.Text = "Balls: 0 | Coins: 0"

local ballCount, coinCount = 0, 0
local items = {}

-- Cập nhật HUD
local function updateHUD()
    counterLabel.Text = ("Balls: %d | Coins: %d"):format(ballCount, coinCount)
end

-- Thêm vật phẩm vào danh sách theo dõi
local function addItem(obj)
    if obj:IsA("BasePart") then
        local name = obj.Name:lower()
        if name:find("beachball") or name:find("coin") then
            table.insert(items, obj)
            obj.AncestryChanged:Connect(function(_, parent)
                if not parent then
                    if name:find("beachball") then
                        ballCount += 1
                    elseif name:find("coin") then
                        coinCount += 1
                    end
                    updateHUD()
                end
            end)
        end
    end
end

-- Lắng nghe vật phẩm mới spawn
Workspace.DescendantAdded:Connect(addItem)

-- Quét ban đầu
for _, obj in ipairs(Workspace:GetDescendants()) do
    addItem(obj)
end

-- Tìm vật phẩm gần nhất (ưu tiên beachball)
local function getClosestItem()
    local closest, closestDist
    for _, obj in ipairs(items) do
        if obj and obj.Parent then
            local dist = (hrp.Position - obj.Position).Magnitude
            if dist <= scanRange then
                if not closest 
                or dist < closestDist 
                or (closest.Name:lower():find("coin") and obj.Name:lower():find("beachball")) then
                    closest = obj
                    closestDist = dist
                end
            end
        end
    end
    return closest
end

-- Dịch chuyển thẳng tới vật phẩm
local function teleportTo(pos)
    hrp.CFrame = CFrame.new(pos)
end

-- Vòng lặp chính
task.spawn(function()
    while task.wait(scanDelay) do
        local target = getClosestItem()
        if target then
            teleportTo(target.Position + Vector3.new(0, pickupHeight, 0))
        end
    end
end)
