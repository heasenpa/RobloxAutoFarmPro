-- MM2 Instant Coin Pickup + NoClip
-- Nhặt coin ngay lập tức khi đến gần, xuyên tường

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- Cài đặt
local scanRange = 100
local speed = 60
local scanDelay = 0.02
local pickupDistance = 5 -- khoảng cách kích hoạt nhặt
local coinCount = 0
local items = {}

-- HUD
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local counterLabel = Instance.new("TextLabel", screenGui)
counterLabel.Size = UDim2.new(0, 200, 0, 50)
counterLabel.Position = UDim2.new(0, 10, 0, 10)
counterLabel.BackgroundTransparency = 0.5
counterLabel.BackgroundColor3 = Color3.new(0,0,0)
counterLabel.TextColor3 = Color3.new(1,1,1)
counterLabel.TextScaled = true
counterLabel.Text = "Coins: 0"

-- NoClip
RunService.Stepped:Connect(function()
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end)

-- Thêm coin vào danh sách
local function addItem(obj)
    if obj:IsA("BasePart") and obj.Name:lower():find("coin") then
        table.insert(items, obj)
        obj.AncestryChanged:Connect(function(_, parent)
            if not parent then
                coinCount += 1
                counterLabel.Text = ("Coins: %d"):format(coinCount)
            end
        end)
    end
end

-- Theo dõi coin mới spawn
Workspace.DescendantAdded:Connect(addItem)

-- Quét ban đầu
for _, obj in ipairs(Workspace:GetDescendants()) do
    addItem(obj)
end

-- Tìm coin gần nhất
local function getClosestItem()
    local closest, closestDist
    for _, obj in ipairs(items) do
        if obj and obj.Parent then
            local dist = (hrp.Position - obj.Position).Magnitude
            if dist <= scanRange then
                if not closest or dist < closestDist then
                    closest = obj
                    closestDist = dist
                end
            end
        end
    end
    return closest
end

-- Nhặt coin ngay khi tới gần
local function pickupCoin(coin)
    if coin and coin.Parent then
        firetouchinterest(hrp, coin, 0)
        firetouchinterest(hrp, coin, 1)
    end
end

-- Vòng lặp chính
task.spawn(function()
    while task.wait(scanDelay) do
        local target = getClosestItem()
        if target then
            local distance = (hrp.Position - target.Position).Magnitude
            if distance > pickupDistance then
                local direction = (target.Position - hrp.Position).Unit
                hrp.CFrame = CFrame.new(hrp.Position + direction * speed * scanDelay)
            else
                pickupCoin(target)
            end
        end
    end
end)
