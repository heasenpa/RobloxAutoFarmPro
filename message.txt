local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Hàm tạo GUI + logic reset
local function setupCoinGUI()
    -- Xóa cũ nếu còn
    if LocalPlayer.PlayerGui:FindFirstChild("CoinDebug") then
        LocalPlayer.PlayerGui.CoinDebug:Destroy()
    end

    local gui = Instance.new("ScreenGui")
    gui.Name = "CoinDebug"
    gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 220, 0, 50)
    label.Position = UDim2.new(0.5, -110, 0.05, 0)
    label.BackgroundColor3 = Color3.fromRGB(0,0,0)
    label.BackgroundTransparency = 0.3
    label.TextColor3 = Color3.fromRGB(255,255,0)
    label.TextSize = 18
    label.Font = Enum.Font.SourceSansBold
    label.Text = "Coins: ?"
    label.Parent = gui

    -- Lấy CoinLabel trong GUI gốc của game
    local coinLabel = LocalPlayer:WaitForChild("PlayerGui")
        :WaitForChild("MainGUI")
        :WaitForChild("Lobby")
        :WaitForChild("Dock")
        :WaitForChild("CoinBags")
        :WaitForChild("Container")
        :WaitForChild("BeachBall")
        :WaitForChild("CurrencyFrame")
        :WaitForChild("Icon")
        :WaitForChild("Coins")

    -- Hàm update
    local function updateCoins()
        local amount = tonumber(coinLabel.Text) or 0
        label.Text = "Coins: " .. amount .. "/40"

        if amount >= 40 then
            label.TextColor3 = Color3.fromRGB(255,0,0)
            label.Text = "FULL! ("..amount.."/40) - Resetting..."

            -- Reset nhân vật
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.Health = 0
            end
        else
            label.TextColor3 = Color3.fromRGB(0,255,0)
        end
    end

    updateCoins()
    coinLabel:GetPropertyChangedSignal("Text"):Connect(updateCoins)
end

-- Tạo lần đầu
setupCoinGUI()

-- Tạo lại mỗi khi nhân vật respawn
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1) -- chờ PlayerGui load lại
    setupCoinGUI()
end)
